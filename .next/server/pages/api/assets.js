"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/assets";
exports.ids = ["pages/api/assets"];
exports.modules = {

/***/ "mime":
/*!***********************!*\
  !*** external "mime" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("mime");

/***/ }),

/***/ "nullthrows":
/*!*****************************!*\
  !*** external "nullthrows" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("nullthrows");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./common/helpers.ts":
/*!***************************!*\
  !*** ./common/helpers.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"NoUpdateAvailableError\": () => (/* binding */ NoUpdateAvailableError),\n/* harmony export */   \"convertToDictionaryItemsRepresentation\": () => (/* binding */ convertToDictionaryItemsRepresentation),\n/* harmony export */   \"signRSASHA256\": () => (/* binding */ signRSASHA256),\n/* harmony export */   \"getPrivateKeyAsync\": () => (/* binding */ getPrivateKeyAsync),\n/* harmony export */   \"getLatestUpdateBundlePathForRuntimeVersionAsync\": () => (/* binding */ getLatestUpdateBundlePathForRuntimeVersionAsync),\n/* harmony export */   \"getAssetMetadataAsync\": () => (/* binding */ getAssetMetadataAsync),\n/* harmony export */   \"createRollBackDirectiveAsync\": () => (/* binding */ createRollBackDirectiveAsync),\n/* harmony export */   \"createNoUpdateAvailableDirectiveAsync\": () => (/* binding */ createNoUpdateAvailableDirectiveAsync),\n/* harmony export */   \"getMetadataAsync\": () => (/* binding */ getMetadataAsync),\n/* harmony export */   \"getExpoConfigAsync\": () => (/* binding */ getExpoConfigAsync),\n/* harmony export */   \"convertSHA256HashToUUID\": () => (/* binding */ convertSHA256HashToUUID),\n/* harmony export */   \"truthy\": () => (/* binding */ truthy)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var mime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! mime */ \"mime\");\n/* harmony import */ var mime__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(mime__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nclass NoUpdateAvailableError extends Error {\n}\nfunction createHash(file, hashingAlgorithm, encoding) {\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(hashingAlgorithm).update(file).digest(encoding);\n}\nfunction getBase64URLEncoding(base64EncodedString) {\n    return base64EncodedString.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n}\nfunction convertToDictionaryItemsRepresentation(obj) {\n    return new Map(Object.entries(obj).map(([k, v])=>{\n        return [\n            k,\n            [\n                v,\n                new Map()\n            ]\n        ];\n    }));\n}\nfunction signRSASHA256(data, privateKey) {\n    const sign = crypto__WEBPACK_IMPORTED_MODULE_0___default().createSign(\"RSA-SHA256\");\n    sign.update(data, \"utf8\");\n    sign.end();\n    return sign.sign(privateKey, \"base64\");\n}\nasync function getPrivateKeyAsync() {\n    const privateKeyPath = process.env.PRIVATE_KEY_PATH;\n    if (!privateKeyPath) {\n        return null;\n    }\n    const pemBuffer = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(path__WEBPACK_IMPORTED_MODULE_4___default().resolve(privateKeyPath));\n    return pemBuffer.toString(\"utf8\");\n}\nasync function getLatestUpdateBundlePathForRuntimeVersionAsync(runtimeVersion) {\n    const updatesDirectoryForRuntimeVersion = `updates/${runtimeVersion}`;\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(updatesDirectoryForRuntimeVersion)) {\n        throw new Error(\"Unsupported runtime version\");\n    }\n    const filesInUpdatesDirectory = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readdir(updatesDirectoryForRuntimeVersion);\n    const directoriesInUpdatesDirectory = (await Promise.all(filesInUpdatesDirectory.map(async (file)=>{\n        const fileStat = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().stat(path__WEBPACK_IMPORTED_MODULE_4___default().join(updatesDirectoryForRuntimeVersion, file));\n        return fileStat.isDirectory() ? file : null;\n    }))).filter(truthy).sort((a, b)=>parseInt(b, 10) - parseInt(a, 10)\n    );\n    return path__WEBPACK_IMPORTED_MODULE_4___default().join(updatesDirectoryForRuntimeVersion, directoriesInUpdatesDirectory[0]);\n}\nasync function getAssetMetadataAsync(arg) {\n    const assetFilePath = `${arg.updateBundlePath}/${arg.filePath}`;\n    const asset = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(path__WEBPACK_IMPORTED_MODULE_4___default().resolve(assetFilePath), null);\n    const assetHash = getBase64URLEncoding(createHash(asset, \"sha256\", \"base64\"));\n    const key = createHash(asset, \"md5\", \"hex\");\n    const keyExtensionSuffix = arg.isLaunchAsset ? \"bundle\" : arg.ext;\n    const contentType = arg.isLaunchAsset ? \"application/javascript\" : mime__WEBPACK_IMPORTED_MODULE_3___default().getType(arg.ext);\n    return {\n        hash: assetHash,\n        key,\n        fileExtension: `.${keyExtensionSuffix}`,\n        contentType,\n        url: `${process.env.HOSTNAME}/api/assets?asset=${assetFilePath}&runtimeVersion=${arg.runtimeVersion}&platform=${arg.platform}`\n    };\n}\nasync function createRollBackDirectiveAsync(updateBundlePath) {\n    try {\n        const rollbackFilePath = `${updateBundlePath}/rollback`;\n        const rollbackFileStat = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().stat(rollbackFilePath);\n        return {\n            type: \"rollBackToEmbedded\",\n            parameters: {\n                commitTime: new Date(rollbackFileStat.birthtime).toISOString()\n            }\n        };\n    } catch (error) {\n        throw new Error(`No rollback found. Error: ${error}`);\n    }\n}\nasync function createNoUpdateAvailableDirectiveAsync() {\n    return {\n        type: \"noUpdateAvailable\"\n    };\n}\nasync function getMetadataAsync({ updateBundlePath , runtimeVersion  }) {\n    try {\n        const metadataPath = `${updateBundlePath}/metadata.json`;\n        const updateMetadataBuffer = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(path__WEBPACK_IMPORTED_MODULE_4___default().resolve(metadataPath), null);\n        const metadataJson = JSON.parse(updateMetadataBuffer.toString(\"utf-8\"));\n        const metadataStat = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().stat(metadataPath);\n        return {\n            metadataJson,\n            createdAt: new Date(metadataStat.birthtime).toISOString(),\n            id: createHash(updateMetadataBuffer, \"sha256\", \"hex\")\n        };\n    } catch (error) {\n        throw new Error(`No update found with runtime version: ${runtimeVersion}. Error: ${error}`);\n    }\n}\n/**\n * This adds the `@expo/config`-exported config to `extra.expoConfig`, which is a common thing\n * done by implementors of the expo-updates specification since a lot of Expo modules use it.\n * It is not required by the specification, but is included here in the example client and server\n * for demonstration purposes. EAS Update does something conceptually very similar.\n */ async function getExpoConfigAsync({ updateBundlePath , runtimeVersion  }) {\n    try {\n        const expoConfigPath = `${updateBundlePath}/expoConfig.json`;\n        const expoConfigBuffer = await fs_promises__WEBPACK_IMPORTED_MODULE_2___default().readFile(path__WEBPACK_IMPORTED_MODULE_4___default().resolve(expoConfigPath), null);\n        const expoConfigJson = JSON.parse(expoConfigBuffer.toString(\"utf-8\"));\n        return expoConfigJson;\n    } catch (error) {\n        throw new Error(`No expo config json found with runtime version: ${runtimeVersion}. Error: ${error}`);\n    }\n}\nfunction convertSHA256HashToUUID(value) {\n    return `${value.slice(0, 8)}-${value.slice(8, 12)}-${value.slice(12, 16)}-${value.slice(16, 20)}-${value.slice(20, 32)}`;\n}\nfunction truthy(value) {\n    return !!value;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQ0MsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUVELEtBQUssQ0FBQ0MsS0FBSyxDQUNyRixFQUFFLEVBQ0YsRUFBRSxDQUNILENBQUMsQ0FBQyxFQUFFRCxLQUFLLENBQUNDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQzVCO0FBRU0sU0FBU2pELE1BQU0sQ0FBU2dELEtBQWdDLEVBQW1CO0lBQ2hGLE9BQU8sQ0FBQyxDQUFDQSxLQUFLLENBQUM7Q0FDaEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jdXN0b20tZXhwby11cGRhdGVzLXNlcnZlci8uL2NvbW1vbi9oZWxwZXJzLnRzP2E5NzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNyeXB0bywgeyBCaW5hcnlUb1RleHRFbmNvZGluZyB9IGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgZnNTeW5jIGZyb20gJ2ZzJztcbmltcG9ydCBmcyBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgbWltZSBmcm9tICdtaW1lJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRGljdGlvbmFyeSB9IGZyb20gJ3N0cnVjdHVyZWQtaGVhZGVycyc7XG5cbmV4cG9ydCBjbGFzcyBOb1VwZGF0ZUF2YWlsYWJsZUVycm9yIGV4dGVuZHMgRXJyb3Ige31cblxuZnVuY3Rpb24gY3JlYXRlSGFzaChmaWxlOiBCdWZmZXIsIGhhc2hpbmdBbGdvcml0aG06IHN0cmluZywgZW5jb2Rpbmc6IEJpbmFyeVRvVGV4dEVuY29kaW5nKSB7XG4gIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaChoYXNoaW5nQWxnb3JpdGhtKS51cGRhdGUoZmlsZSkuZGlnZXN0KGVuY29kaW5nKTtcbn1cblxuZnVuY3Rpb24gZ2V0QmFzZTY0VVJMRW5jb2RpbmcoYmFzZTY0RW5jb2RlZFN0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGJhc2U2NEVuY29kZWRTdHJpbmcucmVwbGFjZSgvXFwrL2csICctJykucmVwbGFjZSgvXFwvL2csICdfJykucmVwbGFjZSgvPSskLywgJycpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydFRvRGljdGlvbmFyeUl0ZW1zUmVwcmVzZW50YXRpb24ob2JqOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KTogRGljdGlvbmFyeSB7XG4gIHJldHVybiBuZXcgTWFwKFxuICAgIE9iamVjdC5lbnRyaWVzKG9iaikubWFwKChbaywgdl0pID0+IHtcbiAgICAgIHJldHVybiBbaywgW3YsIG5ldyBNYXAoKV1dO1xuICAgIH0pXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaWduUlNBU0hBMjU2KGRhdGE6IHN0cmluZywgcHJpdmF0ZUtleTogc3RyaW5nKSB7XG4gIGNvbnN0IHNpZ24gPSBjcnlwdG8uY3JlYXRlU2lnbignUlNBLVNIQTI1NicpO1xuICBzaWduLnVwZGF0ZShkYXRhLCAndXRmOCcpO1xuICBzaWduLmVuZCgpO1xuICByZXR1cm4gc2lnbi5zaWduKHByaXZhdGVLZXksICdiYXNlNjQnKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFByaXZhdGVLZXlBc3luYygpIHtcbiAgY29uc3QgcHJpdmF0ZUtleVBhdGggPSBwcm9jZXNzLmVudi5QUklWQVRFX0tFWV9QQVRIO1xuICBpZiAoIXByaXZhdGVLZXlQYXRoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBwZW1CdWZmZXIgPSBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUocHJpdmF0ZUtleVBhdGgpKTtcbiAgcmV0dXJuIHBlbUJ1ZmZlci50b1N0cmluZygndXRmOCcpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TGF0ZXN0VXBkYXRlQnVuZGxlUGF0aEZvclJ1bnRpbWVWZXJzaW9uQXN5bmMocnVudGltZVZlcnNpb246IHN0cmluZykge1xuICBjb25zdCB1cGRhdGVzRGlyZWN0b3J5Rm9yUnVudGltZVZlcnNpb24gPSBgdXBkYXRlcy8ke3J1bnRpbWVWZXJzaW9ufWA7XG4gIGlmICghZnNTeW5jLmV4aXN0c1N5bmModXBkYXRlc0RpcmVjdG9yeUZvclJ1bnRpbWVWZXJzaW9uKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgcnVudGltZSB2ZXJzaW9uJyk7XG4gIH1cblxuICBjb25zdCBmaWxlc0luVXBkYXRlc0RpcmVjdG9yeSA9IGF3YWl0IGZzLnJlYWRkaXIodXBkYXRlc0RpcmVjdG9yeUZvclJ1bnRpbWVWZXJzaW9uKTtcbiAgY29uc3QgZGlyZWN0b3JpZXNJblVwZGF0ZXNEaXJlY3RvcnkgPSAoXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBmaWxlc0luVXBkYXRlc0RpcmVjdG9yeS5tYXAoYXN5bmMgKGZpbGUpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZVN0YXQgPSBhd2FpdCBmcy5zdGF0KHBhdGguam9pbih1cGRhdGVzRGlyZWN0b3J5Rm9yUnVudGltZVZlcnNpb24sIGZpbGUpKTtcbiAgICAgICAgcmV0dXJuIGZpbGVTdGF0LmlzRGlyZWN0b3J5KCkgPyBmaWxlIDogbnVsbDtcbiAgICAgIH0pXG4gICAgKVxuICApXG4gICAgLmZpbHRlcih0cnV0aHkpXG4gICAgLnNvcnQoKGEsIGIpID0+IHBhcnNlSW50KGIsIDEwKSAtIHBhcnNlSW50KGEsIDEwKSk7XG4gIHJldHVybiBwYXRoLmpvaW4odXBkYXRlc0RpcmVjdG9yeUZvclJ1bnRpbWVWZXJzaW9uLCBkaXJlY3Rvcmllc0luVXBkYXRlc0RpcmVjdG9yeVswXSk7XG59XG5cbnR5cGUgR2V0QXNzZXRNZXRhZGF0YUFyZyA9XG4gIHwge1xuICAgICAgdXBkYXRlQnVuZGxlUGF0aDogc3RyaW5nO1xuICAgICAgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgIGV4dDogbnVsbDtcbiAgICAgIGlzTGF1bmNoQXNzZXQ6IHRydWU7XG4gICAgICBydW50aW1lVmVyc2lvbjogc3RyaW5nO1xuICAgICAgcGxhdGZvcm06IHN0cmluZztcbiAgICB9XG4gIHwge1xuICAgICAgdXBkYXRlQnVuZGxlUGF0aDogc3RyaW5nO1xuICAgICAgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgIGV4dDogc3RyaW5nO1xuICAgICAgaXNMYXVuY2hBc3NldDogZmFsc2U7XG4gICAgICBydW50aW1lVmVyc2lvbjogc3RyaW5nO1xuICAgICAgcGxhdGZvcm06IHN0cmluZztcbiAgICB9O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXNzZXRNZXRhZGF0YUFzeW5jKGFyZzogR2V0QXNzZXRNZXRhZGF0YUFyZykge1xuICBjb25zdCBhc3NldEZpbGVQYXRoID0gYCR7YXJnLnVwZGF0ZUJ1bmRsZVBhdGh9LyR7YXJnLmZpbGVQYXRofWA7XG4gIGNvbnN0IGFzc2V0ID0gYXdhaXQgZnMucmVhZEZpbGUocGF0aC5yZXNvbHZlKGFzc2V0RmlsZVBhdGgpLCBudWxsKTtcbiAgY29uc3QgYXNzZXRIYXNoID0gZ2V0QmFzZTY0VVJMRW5jb2RpbmcoY3JlYXRlSGFzaChhc3NldCwgJ3NoYTI1NicsICdiYXNlNjQnKSk7XG4gIGNvbnN0IGtleSA9IGNyZWF0ZUhhc2goYXNzZXQsICdtZDUnLCAnaGV4Jyk7XG4gIGNvbnN0IGtleUV4dGVuc2lvblN1ZmZpeCA9IGFyZy5pc0xhdW5jaEFzc2V0ID8gJ2J1bmRsZScgOiBhcmcuZXh0O1xuICBjb25zdCBjb250ZW50VHlwZSA9IGFyZy5pc0xhdW5jaEFzc2V0ID8gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnIDogbWltZS5nZXRUeXBlKGFyZy5leHQpO1xuXG4gIHJldHVybiB7XG4gICAgaGFzaDogYXNzZXRIYXNoLFxuICAgIGtleSxcbiAgICBmaWxlRXh0ZW5zaW9uOiBgLiR7a2V5RXh0ZW5zaW9uU3VmZml4fWAsXG4gICAgY29udGVudFR5cGUsXG4gICAgdXJsOiBgJHtwcm9jZXNzLmVudi5IT1NUTkFNRX0vYXBpL2Fzc2V0cz9hc3NldD0ke2Fzc2V0RmlsZVBhdGh9JnJ1bnRpbWVWZXJzaW9uPSR7YXJnLnJ1bnRpbWVWZXJzaW9ufSZwbGF0Zm9ybT0ke2FyZy5wbGF0Zm9ybX1gLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlUm9sbEJhY2tEaXJlY3RpdmVBc3luYyh1cGRhdGVCdW5kbGVQYXRoOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByb2xsYmFja0ZpbGVQYXRoID0gYCR7dXBkYXRlQnVuZGxlUGF0aH0vcm9sbGJhY2tgO1xuICAgIGNvbnN0IHJvbGxiYWNrRmlsZVN0YXQgPSBhd2FpdCBmcy5zdGF0KHJvbGxiYWNrRmlsZVBhdGgpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAncm9sbEJhY2tUb0VtYmVkZGVkJyxcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgY29tbWl0VGltZTogbmV3IERhdGUocm9sbGJhY2tGaWxlU3RhdC5iaXJ0aHRpbWUpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyByb2xsYmFjayBmb3VuZC4gRXJyb3I6ICR7ZXJyb3J9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU5vVXBkYXRlQXZhaWxhYmxlRGlyZWN0aXZlQXN5bmMoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ25vVXBkYXRlQXZhaWxhYmxlJyxcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1ldGFkYXRhQXN5bmMoe1xuICB1cGRhdGVCdW5kbGVQYXRoLFxuICBydW50aW1lVmVyc2lvbixcbn06IHtcbiAgdXBkYXRlQnVuZGxlUGF0aDogc3RyaW5nO1xuICBydW50aW1lVmVyc2lvbjogc3RyaW5nO1xufSkge1xuICB0cnkge1xuICAgIGNvbnN0IG1ldGFkYXRhUGF0aCA9IGAke3VwZGF0ZUJ1bmRsZVBhdGh9L21ldGFkYXRhLmpzb25gO1xuICAgIGNvbnN0IHVwZGF0ZU1ldGFkYXRhQnVmZmVyID0gYXdhaXQgZnMucmVhZEZpbGUocGF0aC5yZXNvbHZlKG1ldGFkYXRhUGF0aCksIG51bGwpO1xuICAgIGNvbnN0IG1ldGFkYXRhSnNvbiA9IEpTT04ucGFyc2UodXBkYXRlTWV0YWRhdGFCdWZmZXIudG9TdHJpbmcoJ3V0Zi04JykpO1xuICAgIGNvbnN0IG1ldGFkYXRhU3RhdCA9IGF3YWl0IGZzLnN0YXQobWV0YWRhdGFQYXRoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBtZXRhZGF0YUpzb24sXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKG1ldGFkYXRhU3RhdC5iaXJ0aHRpbWUpLnRvSVNPU3RyaW5nKCksXG4gICAgICBpZDogY3JlYXRlSGFzaCh1cGRhdGVNZXRhZGF0YUJ1ZmZlciwgJ3NoYTI1NicsICdoZXgnKSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgTm8gdXBkYXRlIGZvdW5kIHdpdGggcnVudGltZSB2ZXJzaW9uOiAke3J1bnRpbWVWZXJzaW9ufS4gRXJyb3I6ICR7ZXJyb3J9YCk7XG4gIH1cbn1cblxuLyoqXG4gKiBUaGlzIGFkZHMgdGhlIGBAZXhwby9jb25maWdgLWV4cG9ydGVkIGNvbmZpZyB0byBgZXh0cmEuZXhwb0NvbmZpZ2AsIHdoaWNoIGlzIGEgY29tbW9uIHRoaW5nXG4gKiBkb25lIGJ5IGltcGxlbWVudG9ycyBvZiB0aGUgZXhwby11cGRhdGVzIHNwZWNpZmljYXRpb24gc2luY2UgYSBsb3Qgb2YgRXhwbyBtb2R1bGVzIHVzZSBpdC5cbiAqIEl0IGlzIG5vdCByZXF1aXJlZCBieSB0aGUgc3BlY2lmaWNhdGlvbiwgYnV0IGlzIGluY2x1ZGVkIGhlcmUgaW4gdGhlIGV4YW1wbGUgY2xpZW50IGFuZCBzZXJ2ZXJcbiAqIGZvciBkZW1vbnN0cmF0aW9uIHB1cnBvc2VzLiBFQVMgVXBkYXRlIGRvZXMgc29tZXRoaW5nIGNvbmNlcHR1YWxseSB2ZXJ5IHNpbWlsYXIuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFeHBvQ29uZmlnQXN5bmMoe1xuICB1cGRhdGVCdW5kbGVQYXRoLFxuICBydW50aW1lVmVyc2lvbixcbn06IHtcbiAgdXBkYXRlQnVuZGxlUGF0aDogc3RyaW5nO1xuICBydW50aW1lVmVyc2lvbjogc3RyaW5nO1xufSk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZXhwb0NvbmZpZ1BhdGggPSBgJHt1cGRhdGVCdW5kbGVQYXRofS9leHBvQ29uZmlnLmpzb25gO1xuICAgIGNvbnN0IGV4cG9Db25maWdCdWZmZXIgPSBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUoZXhwb0NvbmZpZ1BhdGgpLCBudWxsKTtcbiAgICBjb25zdCBleHBvQ29uZmlnSnNvbiA9IEpTT04ucGFyc2UoZXhwb0NvbmZpZ0J1ZmZlci50b1N0cmluZygndXRmLTgnKSk7XG4gICAgcmV0dXJuIGV4cG9Db25maWdKc29uO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBObyBleHBvIGNvbmZpZyBqc29uIGZvdW5kIHdpdGggcnVudGltZSB2ZXJzaW9uOiAke3J1bnRpbWVWZXJzaW9ufS4gRXJyb3I6ICR7ZXJyb3J9YFxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRTSEEyNTZIYXNoVG9VVUlEKHZhbHVlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGAke3ZhbHVlLnNsaWNlKDAsIDgpfS0ke3ZhbHVlLnNsaWNlKDgsIDEyKX0tJHt2YWx1ZS5zbGljZSgxMiwgMTYpfS0ke3ZhbHVlLnNsaWNlKFxuICAgIDE2LFxuICAgIDIwXG4gICl9LSR7dmFsdWUuc2xpY2UoMjAsIDMyKX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJ1dGh5PFRWYWx1ZT4odmFsdWU6IFRWYWx1ZSB8IG51bGwgfCB1bmRlZmluZWQpOiB2YWx1ZSBpcyBUVmFsdWUge1xuICByZXR1cm4gISF2YWx1ZTtcbn1cbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJmc1N5bmMiLCJmcyIsIm1pbWUiLCJwYXRoIiwiTm9VcGRhdGVBdmFpbGFibGVFcnJvciIsIkVycm9yIiwiY3JlYXRlSGFzaCIsImZpbGUiLCJoYXNoaW5nQWxnb3JpdGhtIiwiZW5jb2RpbmciLCJ1cGRhdGUiLCJkaWdlc3QiLCJnZXRCYXNlNjRVUkxFbmNvZGluZyIsImJhc2U2NEVuY29kZWRTdHJpbmciLCJyZXBsYWNlIiwiY29udmVydFRvRGljdGlvbmFyeUl0ZW1zUmVwcmVzZW50YXRpb24iLCJvYmoiLCJNYXAiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwiayIsInYiLCJzaWduUlNBU0hBMjU2IiwiZGF0YSIsInByaXZhdGVLZXkiLCJzaWduIiwiY3JlYXRlU2lnbiIsImVuZCIsImdldFByaXZhdGVLZXlBc3luYyIsInByaXZhdGVLZXlQYXRoIiwicHJvY2VzcyIsImVudiIsIlBSSVZBVEVfS0VZX1BBVEgiLCJwZW1CdWZmZXIiLCJyZWFkRmlsZSIsInJlc29sdmUiLCJ0b1N0cmluZyIsImdldExhdGVzdFVwZGF0ZUJ1bmRsZVBhdGhGb3JSdW50aW1lVmVyc2lvbkFzeW5jIiwicnVudGltZVZlcnNpb24iLCJ1cGRhdGVzRGlyZWN0b3J5Rm9yUnVudGltZVZlcnNpb24iLCJleGlzdHNTeW5jIiwiZmlsZXNJblVwZGF0ZXNEaXJlY3RvcnkiLCJyZWFkZGlyIiwiZGlyZWN0b3JpZXNJblVwZGF0ZXNEaXJlY3RvcnkiLCJQcm9taXNlIiwiYWxsIiwiZmlsZVN0YXQiLCJzdGF0Iiwiam9pbiIsImlzRGlyZWN0b3J5IiwiZmlsdGVyIiwidHJ1dGh5Iiwic29ydCIsImEiLCJiIiwicGFyc2VJbnQiLCJnZXRBc3NldE1ldGFkYXRhQXN5bmMiLCJhcmciLCJhc3NldEZpbGVQYXRoIiwidXBkYXRlQnVuZGxlUGF0aCIsImZpbGVQYXRoIiwiYXNzZXQiLCJhc3NldEhhc2giLCJrZXkiLCJrZXlFeHRlbnNpb25TdWZmaXgiLCJpc0xhdW5jaEFzc2V0IiwiZXh0IiwiY29udGVudFR5cGUiLCJnZXRUeXBlIiwiaGFzaCIsImZpbGVFeHRlbnNpb24iLCJ1cmwiLCJIT1NUTkFNRSIsInBsYXRmb3JtIiwiY3JlYXRlUm9sbEJhY2tEaXJlY3RpdmVBc3luYyIsInJvbGxiYWNrRmlsZVBhdGgiLCJyb2xsYmFja0ZpbGVTdGF0IiwidHlwZSIsInBhcmFtZXRlcnMiLCJjb21taXRUaW1lIiwiRGF0ZSIsImJpcnRodGltZSIsInRvSVNPU3RyaW5nIiwiZXJyb3IiLCJjcmVhdGVOb1VwZGF0ZUF2YWlsYWJsZURpcmVjdGl2ZUFzeW5jIiwiZ2V0TWV0YWRhdGFBc3luYyIsIm1ldGFkYXRhUGF0aCIsInVwZGF0ZU1ldGFkYXRhQnVmZmVyIiwibWV0YWRhdGFKc29uIiwiSlNPTiIsInBhcnNlIiwibWV0YWRhdGFTdGF0IiwiY3JlYXRlZEF0IiwiaWQiLCJnZXRFeHBvQ29uZmlnQXN5bmMiLCJleHBvQ29uZmlnUGF0aCIsImV4cG9Db25maWdCdWZmZXIiLCJleHBvQ29uZmlnSnNvbiIsImNvbnZlcnRTSEEyNTZIYXNoVG9VVUlEIiwidmFsdWUiLCJzbGljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./common/helpers.ts\n");

/***/ }),

/***/ "(api)/./pages/api/assets.ts":
/*!*****************************!*\
  !*** ./pages/api/assets.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ assetsEndpoint)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var mime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mime */ \"mime\");\n/* harmony import */ var mime__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mime__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var nullthrows__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! nullthrows */ \"nullthrows\");\n/* harmony import */ var nullthrows__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(nullthrows__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _common_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers */ \"(api)/./common/helpers.ts\");\n\n\n\n\n\nasync function assetsEndpoint(req, res) {\n    const { asset: assetName , runtimeVersion , platform  } = req.query;\n    if (!assetName || typeof assetName !== \"string\") {\n        res.statusCode = 400;\n        res.json({\n            error: \"No asset name provided.\"\n        });\n        return;\n    }\n    if (platform !== \"ios\" && platform !== \"android\") {\n        res.statusCode = 400;\n        res.json({\n            error: 'No platform provided. Expected \"ios\" or \"android\".'\n        });\n        return;\n    }\n    if (!runtimeVersion || typeof runtimeVersion !== \"string\") {\n        res.statusCode = 400;\n        res.json({\n            error: \"No runtimeVersion provided.\"\n        });\n        return;\n    }\n    let updateBundlePath;\n    try {\n        updateBundlePath = await (0,_common_helpers__WEBPACK_IMPORTED_MODULE_4__.getLatestUpdateBundlePathForRuntimeVersionAsync)(runtimeVersion);\n    } catch (error) {\n        res.statusCode = 404;\n        res.json({\n            error: error.message\n        });\n        return;\n    }\n    const { metadataJson  } = await (0,_common_helpers__WEBPACK_IMPORTED_MODULE_4__.getMetadataAsync)({\n        updateBundlePath,\n        runtimeVersion\n    });\n    const assetPath = path__WEBPACK_IMPORTED_MODULE_3___default().resolve(assetName);\n    const assetMetadata = metadataJson.fileMetadata[platform].assets.find((asset)=>asset.path === assetName.replace(`${updateBundlePath}/`, \"\")\n    );\n    const isLaunchAsset = metadataJson.fileMetadata[platform].bundle === assetName.replace(`${updateBundlePath}/`, \"\");\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(assetPath)) {\n        res.statusCode = 404;\n        res.json({\n            error: `Asset \"${assetName}\" does not exist.`\n        });\n        return;\n    }\n    try {\n        const asset = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(assetPath, null);\n        res.statusCode = 200;\n        res.setHeader(\"content-type\", isLaunchAsset ? \"application/javascript\" : nullthrows__WEBPACK_IMPORTED_MODULE_2___default()(mime__WEBPACK_IMPORTED_MODULE_1___default().getType(assetMetadata.ext)));\n        res.end(asset);\n    } catch (error1) {\n        console.log(error1);\n        res.statusCode = 500;\n        res.json({\n            error: error1\n        });\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2RKLGFBQWEsR0FBRyx3QkFBd0IsR0FBR3pCLGlEQUFVLENBQUNELG1EQUFZLENBQUNxQixhQUFhLENBQUNXLEdBQUcsQ0FBQyxDQUFDLENBQ3ZGLENBQUM7UUFDRnpCLEdBQUcsQ0FBQzBCLEdBQUcsQ0FBQ3pCLEtBQUssQ0FBQyxDQUFDO0tBQ2hCLENBQUMsT0FBT08sTUFBSyxFQUFFO1FBQ2RtQixPQUFPLENBQUNDLEdBQUcsQ0FBQ3BCLE1BQUssQ0FBQyxDQUFDO1FBQ25CUixHQUFHLENBQUNNLFVBQVUsR0FBRyxHQUFHLENBQUM7UUFDckJOLEdBQUcsQ0FBQ08sSUFBSSxDQUFDO1lBQUVDLEtBQUssRUFBTEEsTUFBSztTQUFFLENBQUMsQ0FBQztLQUNyQjtDQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3VzdG9tLWV4cG8tdXBkYXRlcy1zZXJ2ZXIvLi9wYWdlcy9hcGkvYXNzZXRzLnRzP2YwZjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBtaW1lIGZyb20gJ21pbWUnO1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSAnbnVsbHRocm93cyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHtcbiAgZ2V0TGF0ZXN0VXBkYXRlQnVuZGxlUGF0aEZvclJ1bnRpbWVWZXJzaW9uQXN5bmMsXG4gIGdldE1ldGFkYXRhQXN5bmMsXG59IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gYXNzZXRzRW5kcG9pbnQocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgY29uc3QgeyBhc3NldDogYXNzZXROYW1lLCBydW50aW1lVmVyc2lvbiwgcGxhdGZvcm0gfSA9IHJlcS5xdWVyeTtcblxuICBpZiAoIWFzc2V0TmFtZSB8fCB0eXBlb2YgYXNzZXROYW1lICE9PSAnc3RyaW5nJykge1xuICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgIHJlcy5qc29uKHsgZXJyb3I6ICdObyBhc3NldCBuYW1lIHByb3ZpZGVkLicgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHBsYXRmb3JtICE9PSAnaW9zJyAmJiBwbGF0Zm9ybSAhPT0gJ2FuZHJvaWQnKSB7XG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgcmVzLmpzb24oeyBlcnJvcjogJ05vIHBsYXRmb3JtIHByb3ZpZGVkLiBFeHBlY3RlZCBcImlvc1wiIG9yIFwiYW5kcm9pZFwiLicgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCFydW50aW1lVmVyc2lvbiB8fCB0eXBlb2YgcnVudGltZVZlcnNpb24gIT09ICdzdHJpbmcnKSB7XG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgcmVzLmpzb24oeyBlcnJvcjogJ05vIHJ1bnRpbWVWZXJzaW9uIHByb3ZpZGVkLicgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IHVwZGF0ZUJ1bmRsZVBhdGg6IHN0cmluZztcbiAgdHJ5IHtcbiAgICB1cGRhdGVCdW5kbGVQYXRoID0gYXdhaXQgZ2V0TGF0ZXN0VXBkYXRlQnVuZGxlUGF0aEZvclJ1bnRpbWVWZXJzaW9uQXN5bmMocnVudGltZVZlcnNpb24pO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgcmVzLmpzb24oe1xuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgeyBtZXRhZGF0YUpzb24gfSA9IGF3YWl0IGdldE1ldGFkYXRhQXN5bmMoe1xuICAgIHVwZGF0ZUJ1bmRsZVBhdGgsXG4gICAgcnVudGltZVZlcnNpb24sXG4gIH0pO1xuXG4gIGNvbnN0IGFzc2V0UGF0aCA9IHBhdGgucmVzb2x2ZShhc3NldE5hbWUpO1xuICBjb25zdCBhc3NldE1ldGFkYXRhID0gbWV0YWRhdGFKc29uLmZpbGVNZXRhZGF0YVtwbGF0Zm9ybV0uYXNzZXRzLmZpbmQoXG4gICAgKGFzc2V0OiBhbnkpID0+IGFzc2V0LnBhdGggPT09IGFzc2V0TmFtZS5yZXBsYWNlKGAke3VwZGF0ZUJ1bmRsZVBhdGh9L2AsICcnKVxuICApO1xuICBjb25zdCBpc0xhdW5jaEFzc2V0ID1cbiAgICBtZXRhZGF0YUpzb24uZmlsZU1ldGFkYXRhW3BsYXRmb3JtXS5idW5kbGUgPT09IGFzc2V0TmFtZS5yZXBsYWNlKGAke3VwZGF0ZUJ1bmRsZVBhdGh9L2AsICcnKTtcblxuICBpZiAoIWZzLmV4aXN0c1N5bmMoYXNzZXRQYXRoKSkge1xuICAgIHJlcy5zdGF0dXNDb2RlID0gNDA0O1xuICAgIHJlcy5qc29uKHsgZXJyb3I6IGBBc3NldCBcIiR7YXNzZXROYW1lfVwiIGRvZXMgbm90IGV4aXN0LmAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBhc3NldCA9IGZzLnJlYWRGaWxlU3luYyhhc3NldFBhdGgsIG51bGwpO1xuXG4gICAgcmVzLnN0YXR1c0NvZGUgPSAyMDA7XG4gICAgcmVzLnNldEhlYWRlcihcbiAgICAgICdjb250ZW50LXR5cGUnLFxuICAgICAgaXNMYXVuY2hBc3NldCA/ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JyA6IG51bGx0aHJvd3MobWltZS5nZXRUeXBlKGFzc2V0TWV0YWRhdGEuZXh0KSlcbiAgICApO1xuICAgIHJlcy5lbmQoYXNzZXQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICByZXMuc3RhdHVzQ29kZSA9IDUwMDtcbiAgICByZXMuanNvbih7IGVycm9yIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiZnMiLCJtaW1lIiwibnVsbHRocm93cyIsInBhdGgiLCJnZXRMYXRlc3RVcGRhdGVCdW5kbGVQYXRoRm9yUnVudGltZVZlcnNpb25Bc3luYyIsImdldE1ldGFkYXRhQXN5bmMiLCJhc3NldHNFbmRwb2ludCIsInJlcSIsInJlcyIsImFzc2V0IiwiYXNzZXROYW1lIiwicnVudGltZVZlcnNpb24iLCJwbGF0Zm9ybSIsInF1ZXJ5Iiwic3RhdHVzQ29kZSIsImpzb24iLCJlcnJvciIsInVwZGF0ZUJ1bmRsZVBhdGgiLCJtZXNzYWdlIiwibWV0YWRhdGFKc29uIiwiYXNzZXRQYXRoIiwicmVzb2x2ZSIsImFzc2V0TWV0YWRhdGEiLCJmaWxlTWV0YWRhdGEiLCJhc3NldHMiLCJmaW5kIiwicmVwbGFjZSIsImlzTGF1bmNoQXNzZXQiLCJidW5kbGUiLCJleGlzdHNTeW5jIiwicmVhZEZpbGVTeW5jIiwic2V0SGVhZGVyIiwiZ2V0VHlwZSIsImV4dCIsImVuZCIsImNvbnNvbGUiLCJsb2ciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/assets.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/assets.ts"));
module.exports = __webpack_exports__;

})();